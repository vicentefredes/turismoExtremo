<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turismo Extremo Sur</title>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
    
    <link rel="stylesheet" href="style.css">
        
</head>
<body>

    <nav class="navbar sticky-top navbar-expand-lg">
        <a class="navbar-brand" href="index.html" id="brand"><img src="img/logo.png" alt="logo" class="img-fluid"></a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>                    
                    
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav">
            <li class="nav-item" >
              <a class="nav-link" href="#home"> Inicio</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#nosotros">¿Quienes Somos?</a>
            </li>
            <li class="nav-item" >
              <a class="nav-link" href="#servicios">Nuestros Servicios</a>
            </li>
            <li class="nav-item" >
                <a class="nav-link" href="#tiempo">Consultar el Tiempo</a>
              </li>
            <li class="nav-item">
                <a class="nav-link" href="#contacto">Contáctanos</a>
            </li>
          </ul> 
        </div>
    </nav>

    <!-- Main -->
    <div id="main">

        <!-- Me -->
            <article id="home" class="panel intro">
                <header>
                    <h1 id="titulo">Turismo Extremo Sur</h1>
                    <img src="img/magallanes.jpg" alt="magallanes" id="fotoInicio">
                </header>
            </article>

            <article id="nosotros" class="panel">
                <h1>¿Quiénes Somos?</h1>
                <p>hola</p>

            </article>

            <article id="servicios" class="panel">
                <header>
                    <h1 id="titulo">Nuestros Servicios</h1>
                    <p>¡En 'Turismo Extremo Sur' ofrecemos caminatas a estos 3 hermosos paisajes en la Región de Magallanes y la Antártica Chilena!</p>
                </header>
                <section id="seccionServicios">
                    <div class="row justify-content-center">
                        <div class="col-md-4">
                            <div class="card servicio">
                                <h2>Monte Tarn</h2>
                                <img src="img/monte_tarn.jpg" alt="tarn">
                                <div class="embed-responsive embed-responsive-16by9">
                                    <iframe 
                                        class="embed-responsive-item"
                                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d18857.893091421152!2d-71.0442104304413!3d-53.78527573484622!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xbdad5a8e07b4935f%3A0x98b9f30147d05e70!2sMount%20Tarn!5e0!3m2!1ses-419!2scl!4v1714757355306!5m2!1ses-419!2scl" 
                                        allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
                                    </iframe>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card servicio">
                                <h2>Monte Tarn</h2>
                                <img src="img/monte_tarn.jpg" alt="tarn">
                                <div class="embed-responsive embed-responsive-16by9">
                                    <iframe 
                                        class="embed-responsive-item"
                                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d18857.893091421152!2d-71.0442104304413!3d-53.78527573484622!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xbdad5a8e07b4935f%3A0x98b9f30147d05e70!2sMount%20Tarn!5e0!3m2!1ses-419!2scl!4v1714757355306!5m2!1ses-419!2scl" 
                                        allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
                                    </iframe>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card servicio">
                                <h2>Monte Tarn</h2>
                                <img src="img/monte_tarn.jpg" alt="tarn">
                                <div class="embed-responsive embed-responsive-16by9">
                                    <iframe 
                                        class="embed-responsive-item"
                                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d18857.893091421152!2d-71.0442104304413!3d-53.78527573484622!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xbdad5a8e07b4935f%3A0x98b9f30147d05e70!2sMount%20Tarn!5e0!3m2!1ses-419!2scl!4v1714757355306!5m2!1ses-419!2scl" 
                                        allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
                                    </iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </section>
            </article>

            <article id="tiempo" class="panel">
                <header>
                    <h2>Consulta el tiempo:</h2>
                    <p>Aquí podrás ver el tiempo a 10 días en el sector de Punta Arenas:</p>
                </header>
                <section id="seccionTiempo">

                    <table class="table" id="tablaTiempo">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Condición</th>
                                <th>Temp. mín. (°C)</th>
                                <th>Temp. máx. (°C)</th>
                                <th>Lluvia</th>
                                <th>Viento</th>
                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>

                </section>

            </article>

            <article id="contacto" class="panel">
                <header>
                    <h2>Formulario de Contacto:</h2>
                </header>
                <section id="seccionContacto">
                    <form id="formContacto">
                        <div class="form-row">
                            <div class="form-group col-md-6">
                            <label for="inputNombre">Nombre *</label>
                            <input type="text" class="form-control" id="inputNombre" placeholder="Nombre">
                            <div class="invalid-feedback" id="nombreError"></div>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="inputApellido">Apellido *</label>
                                <input type="text" class="form-control" id="inputApellido" placeholder="Apellido">
                                <div class="invalid-feedback" id="apellidoError"></div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="inputEmail">Correo Electrónico *</label>
                                <input type="text" class="form-control" id="inputEmail" placeholder="usuario123@mail.com">
                                <div class="invalid-feedback" id="emailError"></div>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="inputTelefono">Teléfono Celular</label>
                                <input type="number" class="form-control" id="inputTelefono" placeholder="9XXXXXXXX">
                                <div class="invalid-feedback" id="emailError">Por favor ingrese un número de teléfono celular válido</div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-12">
                            <label for="exampleFormControlTextarea1">Mensaje *</label>
                            <textarea class="form-control" id="inputMensaje" rows="6"></textarea>
                            <div class="invalid-feedback" id="mensajeError">El mensaje no puede estar vacío.</div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-12" style="text-align: center; vertical-align: middle;">
                                <button type="button" class="btn btn-secondary" id="btnEnviar">Enviar</button>
                            </div>  
                        </div>
                    </form> 
                </section>	
            </article>

    <!-- Footer -->
        <div id="footer">
            <p class="copyright">
                &copy; Vicente Fredes Estuardo - Analista Programador Computacional DUOC UC 2024
            </p>
        </div>
    </div>


    <script>

        $(document).ready(function() {

            // Función para mostrar el artículo correspondiente al fragmento de URL
                function showArticleFromHash() {
                    var hash = window.location.hash;
                    if (hash) {
                        $('.panel').hide(); // Oculta todos los artículos
                        $(hash).show(); // Muestra el artículo correspondiente al fragmento de URL
                    } else {
                        // Si no hay fragmento en la URL (como en 'index.html'), mostrar el artículo de inicio
                        $('#home').show();
                    }
                }

                // Mostrar el artículo correspondiente al cargar la página
                showArticleFromHash();

                // Manejar el cambio de fragmento de URL
                $(window).on('hashchange', function() {
                    showArticleFromHash();
                });


        // FORMULARIO DE CONTACTO

			// Variables con el formato que deben cumplir los campos de nombre, apellido y correo electrónico
			var formatoNombres = /^[a-zA-Z\u00C0-\u017F\s']+$/;
			var formatoCorreo = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

			// Función que despliega un alert informando que el mensaje en el formulario de contacto se ha enviado (sin validación)
			function mostrarConfirmaciónContacto() {
				window.alert('Mensaje enviado. ¡Gracias por contactarte con nosotros!');

				// Una vez que se envía y se recibe el mensaje, se limpia el formulario
				$("#formContacto")[0].reset();
			}

			// Validación que se debe realizar cuando el usuario hace click en "Enviar"
			$("#btnEnviar").click(function() {
					
				// variables con los valores de los input del usuario
				let nombre = $("#inputNombre").val();
				let apellido = $("#inputApellido").val();
    			let correo = $("#inputEmail").val();
				let telefono = $("#inputTelefono").val();
                let mensaje = $("#inputMensaje").val();

				// variable booleana para verificar si el envío del formularo es valido - se inicia en true, y cambia a false en caso de que un campo no cumpla con los requisitos
				let formularioValido = true;

				// prints de testeo
				console.log(nombre + ' ' + apellido);
				console.log(correo);
    			console.log(telefono);
				console.log(mensaje);

					if (nombre.trim() == '') { // caso - campo obligatorio vacío
						$("#inputNombre").addClass("is-invalid");
						$("#nombreError").text("El nombre es requerido.").show();
						formularioValido = false;
					} else if (!formatoNombres.test(nombre)) { // caso - usuario puso números y/o caracteres especiales
						$("#inputNombre").addClass("is-invalid");
						$("#nombreError").text("Por favor ingrese un nombre válido.").show();
						formularioValido = false;
					}

					if (apellido.trim() == '') { // caso - campo obligatorio vacío
						$("#inputApellido").addClass("is-invalid"); 
						$("#apellidoError").text("El apellido es requerido.").show();
						formularioValido = false;
					} else if (!formatoNombres.test(apellido)) { // caso - usuario puso números y/o caracteres especiales
						$("#inputApellido").addClass("is-invalid");
						$("#apellidoError").text("Por favor ingrese un apellido válido.").show();
						formularioValido = false;
					}

					if (correo.trim() == '') { // caso - campo obligatorio vacío
						$("#inputEmail").addClass("is-invalid");
						$("#emailError").text("El correo electrónico es requerido.").show();
						formularioValido = false;
					} else if (!formatoCorreo.test(correo)) { // caso - no se cumple con el formato de correo electrónico
						$("#inputEmail").addClass("is-invalid");
						$("#emailError").text("Por favor ingrese una dirección de correo electrónico válida.").show();
						formularioValido = false;
					}

					if (telefono.trim() !== '' && telefono < 900000000) { // no es obligatorio - se verifica que lo que se ingrese sea de 9 dígitos y que empiece con 9
						$("#inputTelefono").addClass("is-invalid");
						formularioValido = false;
					}
				
					if (mensaje.trim() == '') { // caso - campo obligatorio vacío
						$("#inputMensaje").addClass("is-invalid");
						formularioValido = false;
					}

					// Si todos los input fueron validados, entonces depliega un mensaje confirmando envío y limpia el formulario
					if (formularioValido) {
						mostrarConfirmaciónContacto();
						console.log("envío exitoso");
					}
				});


				// Validaciones en tiempo real, previas al envío, con avisos al usuario de que no está completando el formulario correctamente

				// Nombre y Apellido - mientras el usuario teclea, verifica que no esté ingresando caracteres no permitidos
				// Los campos no debe estar marcado como inválidos mientras esten vacíos o se esté ingresando texto correctamente
				$("#inputNombre").on("input", function() {
					let nombre = $(this).val();
					if (nombre.trim() !== '' && !formatoNombres.test(nombre)) {
						$("#inputNombre").addClass("is-invalid");
						$("#nombreError").text("Por favor ingrese un nombre válido.").show();
					} else {
						$("#inputNombre").removeClass("is-invalid");
						$("#nombreError").hide();
					}
				});

				$("#inputApellido").on("input", function() {
					let apellido = $(this).val();
					if (apellido.trim() !== '' && !formatoNombres.test(apellido)) {
						$("#inputApellido").addClass("is-invalid");
						$("#apellidoError").text("Por favor ingrese un nombre válido.").show();
					} else {
						$("#inputApellido").removeClass("is-invalid");
						$("#apellidoError").hide();
					}
				});


				// Correo Electrónico 
				// focusout para que, en caso de que el correo tenga un formato invalido, se le de aviso al usuario apenas pase a otros campos
				$("#inputEmail").focusout(function() {
					let correo = $(this).val();
					if (correo.trim() !== '' && !formatoCorreo.test(correo)) {
						$("#inputEmail").addClass("is-invalid");
						$("#emailError").text("Por favor ingrese una dirección de correo electrónico válida.").show();
					} else {
						$("#inputEmail").removeClass("is-invalid");
						$("#emailError").hide();
					}
				});

				// focus para que, en caso de haberse marcado en rojo previamente, el campo vuelva a su estado original apenas se haga click sobre él
				$("#inputEmail").focus(function() {
					let correo = $(this).val();
					
					$("#inputEmail").removeClass("is-invalid");
					$("#emailError").hide();
					
				});


				// Teléfono
				// Mediante el manejo del input se le impide al usuario ingresar caracteres no númericos o más de 9 dígitos
				$("#inputTelefono").on('input', function() {
					let maxLength = 9; // Define la longitud máxima permitida

					this.value = this.value.replace(/\D/g, ''); // Eliminada inmediatamente cualquier caracter no numérico

					if (this.value.length > maxLength) {
						this.value = this.value.slice(0, maxLength); // Limita la longitud del valor al máximo permitido
					}
				});


				// Al no ser un campo obligatorio, solo se verifica que, de ingresarse un valor, este sea de 9 digitos y que empiece con 9 - si no se cumple, se da aviso apenas pasa a otro campo
				$("#inputTelefono").focusout(function() {
					let telefono = $(this).val();

					if (telefono.trim() !== '' && telefono < 900000000) {
						$("#inputTelefono").addClass("is-invalid");
					} else {
						$("#inputTelefono").removeClass("is-invalid");
					}
					
				});

				// focus para que, en caso de haberse marcado en rojo previamente, el campo vuelva a su estado original apenas se haga click sobre él
				$("#inputTelefono").focus(function() {
					
					$("#inputTelefono").removeClass("is-invalid");
					
				});


				// Mensaje - focus para que, en caso de haberse marcado en rojo previamente, el campo vuelva a su estado original apenas se haga click sobre él
				$("#inputMensaje").focus(function() {
					
					$("#inputMensaje").removeClass("is-invalid");
					
				});




            // EL TIEMPO

                var diasSemana = ["Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado", "Domingo"];

					$.get("http://api.weatherapi.com/v1/forecast.json?key=c8171437ad2f4d1e807175311240305&q=Punta%20Arenas&days=10&aqi=no&alerts=no", function(data) { // Se obtiene la API
						$.each(data.forecast.forecastday, function(i, item) { // Se itera por cada objeto del archivo

                            let icono = item.day.condition.icon;

                            let fecha = new Date(item.date);

                            let diaSemana = diasSemana[fecha.getDay()];
                            let dia = fecha.getDate() + 1;
                            let mes = fecha.toLocaleString('es', {month: 'long'})
                            let mesCap = mes.charAt(0).toUpperCase() + mes.slice(1)
                            let anio = fecha.getFullYear();


							console.log(item.date);
                            console.log(diaSemana + " " + dia  + " de " + mesCap + " de " + anio);
                            console.log(item.day.mintemp_c);
                            console.log(item.day.maxtemp_c);
                            console.log('');

                            let filaHTML = '<tr>';
                            filaHTML += '<td>' + diaSemana + ', ' + dia + ' de ' + mesCap + ' de ' + anio + '</td>';
                            filaHTML += `<td> <img src="${icono}" alt="condicion"> </td>`;
                            filaHTML += '<td>' + item.day.mintemp_c + '°C</td>';
                            filaHTML += '<td>' + item.day.maxtemp_c + '°C</td>';
                            filaHTML += '<td>' + item.day.daily_chance_of_rain + '% prob.<br>' + item.day.totalprecip_mm + ' mm </td>';
                            filaHTML += '<td>' + item.day.maxwind_kph + ' km/h </td>';
                            filaHTML += '</tr>';

                            $('#seccionTiempo tbody').append(filaHTML);
						});
					});

                //http://api.weatherapi.com/v1/forecast.json?key=c8171437ad2f4d1e807175311240305&q=Punta%20Arenas&days=10&aqi=no&alerts=no
        });

    </script>
</body>
</html>